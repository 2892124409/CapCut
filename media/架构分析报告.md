# 多媒体查看器架构分析报告

## 当前架构概述

您的多媒体查看器是一个基于Qt和FFmpeg的跨平台应用，支持视频播放、音频播放和图片查看功能。整体架构采用多线程设计，具有良好的性能表现。

## 当前架构问题分析

### 1. 职责不清晰 - VideoPlayer类过于臃肿
- **VideoPlayer** 类承担了太多职责：
  - 视频播放控制
  - 音频播放控制  
  - 图片查看功能
  - OpenGL渲染
  - 线程管理
  - 状态管理

### 2. 缺乏统一的媒体接口
- 视频、音频、图片使用不同的加载方式
- 控制接口不统一（play() vs loadImage()）
- 状态管理分散

### 3. 代码重复
- 三个解码器类（VideoDecoder、AudioDecoder、ImageDecoder）有相似的初始化逻辑
- 线程控制逻辑重复

### 4. 扩展性差
- 添加新的媒体类型需要修改VideoPlayer类
- 控制逻辑与具体实现耦合过紧

## 重构方案设计

### 1. 引入统一的媒体接口
```
IMediaPlayer (接口)
├── VideoPlayer (实现)
├── AudioPlayer (实现)  
└── ImageViewer (实现)
```

### 2. 创建媒体控制器
```
MediaController
├── 管理当前媒体类型
├── 统一控制接口
└── 状态管理
```

### 3. 抽象解码器基类
```
BaseDecoder (抽象基类)
├── VideoDecoder
├── AudioDecoder
└── ImageDecoder
```

### 4. 改进线程管理
- 统一的线程池管理
- 更好的资源生命周期管理

## 重构目标
- 提高代码可读性和可维护性
- 降低耦合度
- 提高扩展性
- 统一接口设计
