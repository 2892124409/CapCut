# 转场画面偏色问题分析与解决

## 问题现象
最初所有转场都有颜色漂移，后期优化后仅第三个转场仍偏色。

## 原因分析
### 通用原因
- 转场/特效滤镜链输入的帧格式与色彩元数据不一致（原图多为 RGB/GBR、PC/full range，管线目标是 YUV420P BT.709/TV）
- zoompan/xfade 在属性不一致时会隐式协商色彩空间/范围，插入默认转换，导致转场帧与正常场景帧不一致

### 第三个转场特殊点
- 起始帧来自上一场景的 Ken Burns 最后一帧，之前直接用原始 RGB 帧进入滤镜，隐式转换最明显，导致第三个转场仍偏色

## 解决方案
### 通用修复
- 在进入滤镜前统一将帧显式转换为目标分辨率的 yuv420p，并写入完整的色彩元数据（colorspace BT.709/BT.601、color_range TV、primaries、TRC、SAR）
- 在滤镜源节点（Ken Burns、转场的 buffer source）显式设置相同的色彩参数，输出帧也补齐元数据，避免滤镜链自行猜测
- 图片解码缩放后立即写入色彩元数据，保证进入所有滤镜的帧定义一致

### 第三个转场特殊处理
- 在 renderTransition 中先把"from"源图缩放/转换到目标 yuv420p 并带上色彩元数据，再生成 Ken Burns 序列取最后一帧，确保起始帧与管线色彩一致

***

